<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>UK Energy Data – Daily snapshot of UK electricity & gas prices</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta
    name="description"
    content="Auto-updated snapshots of UK energy prices based on Ofgem publications and public tariff data, including default tariff cap levels and Octopus Agile half-hourly rates."
  />
  <style>
    :root {
      --bg: #020817;
      --bg-soft: #020817;
      --card: #020817;
      --card-soft: #020817;
      --accent: #38bdf8;
      --accent-soft: rgba(56,189,248,0.12);
      --accent-strong: #60a5fa;
      --text-main: #e5e7eb;
      --text-soft: #9ca3af;
      --border-subtle: rgba(148,163,253,0.18);
      --radius-xl: 22px;
      --radius-lg: 18px;
      --shadow-soft: 0 18px 60px rgba(15,23,42,0.7);
      --font: system-ui,-apple-system,BlinkMacSystemFont,"SF Pro Text","Segoe UI",sans-serif;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 32px 24px 40px;
      font-family: var(--font);
      background: radial-gradient(circle at top left, #111827 0, #020817 32%, #000 100%);
      color: var(--text-main);
    }

    a {
      color: var(--accent);
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }

    .page {
      max-width: 1240px;
      margin: 0 auto;
    }

    /* Header */

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 18px;
      margin-bottom: 26px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand-logo {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0, #38bdf8, #1d4ed8);
      box-shadow: 0 0 18px rgba(56,189,248,0.8);
    }

    .brand-title {
      font-weight: 600;
      font-size: 20px;
      letter-spacing: 0.01em;
    }

    .pill {
      font-size: 10px;
      padding: 3px 8px 4px;
      border-radius: 999px;
      border: 1px solid rgba(56,189,248,0.35);
      color: var(--accent);
      background: rgba(15,23,42,0.9);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .nav {
      display: flex;
      align-items: center;
      gap: 18px;
      font-size: 12px;
      color: var(--text-soft);
    }

    .nav a {
      color: var(--text-soft);
      padding: 4px 0;
    }

    .nav a.active {
      color: var(--accent);
      font-weight: 500;
    }

    .live-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 10px #22c55e;
    }

    .live-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15,23,42,0.98);
      border: 1px solid rgba(34,197,94,0.28);
      font-size: 10px;
      color: #bbf7d0;
    }

    /* Layout */

    .grid-main {
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(260px, 1.4fr);
      gap: 18px;
      margin-bottom: 18px;
    }

    .card {
      background: radial-gradient(circle at top left, rgba(56,189,248,0.06), transparent 55%) border-box,
                  rgba(9,9,11,0.98);
      border-radius: var(--radius-xl);
      border: 1px solid rgba(75,85,99,0.7);
      padding: 18px 18px 16px;
      box-shadow: var(--shadow-soft);
    }

    .card-soft {
      background: rgba(3,7,18,0.98);
      border-radius: var(--radius-xl);
      border: 1px solid rgba(31,41,55,0.9);
      padding: 16px 16px 14px;
      box-shadow: 0 16px 40px rgba(15,23,42,0.6);
    }

    .section-label {
      font-size: 10px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #6b7280;
      margin-bottom: 6px;
    }

    h1 {
      font-size: 24px;
      margin: 0 0 6px;
      color: #e5e7eb;
    }

    .lead {
      font-size: 12px;
      line-height: 1.7;
      color: var(--text-soft);
      max-width: 640px;
      margin-bottom: 12px;
    }

    /* Metric cards */

    .metric-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }

    .metric {
      flex: 1 1 150px;
      min-width: 150px;
      padding: 10px 11px 9px;
      border-radius: 18px;
      background: radial-gradient(circle at top left, rgba(79,70,229,0.14), transparent 70%),
                  rgba(3,7,18,0.96);
      border: 1px solid rgba(75,85,99,0.85);
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .metric-label {
      font-size: 10px;
      color: #9ca3af;
    }

    .metric-value {
      font-size: 17px;
      font-weight: 600;
      color: #f9fafb;
    }

    .metric-sub {
      font-size: 9px;
      color: #6b7280;
    }

    .muted {
      color: #6b7280;
      font-size: 9px;
    }

    .latest-report {
      font-size: 10px;
      color: #9ca3af;
      margin-top: 6px;
    }

    .latest-report a {
      color: var(--accent);
      font-weight: 500;
    }

    /* Agile card */

    .slots-list {
      list-style: none;
      padding: 0;
      margin: 10px 0 0;
      font-size: 10px;
      color: #9ca3af;
    }

    .slots-list li {
      padding: 6px 9px;
      border-radius: 12px;
      margin-bottom: 5px;
      border: 1px solid rgba(75,85,99,0.85);
      background: radial-gradient(circle at right, rgba(56,189,248,0.06), transparent 70%);
      display: flex;
      justify-content: space-between;
      gap: 10px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .slots-label {
      font-weight: 500;
      color: #e5e7eb;
    }

    .slots-price {
      color: var(--accent);
      font-weight: 500;
    }

    /* Lower grid */

    .grid-lower {
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(260px, 1.4fr);
      gap: 18px;
      margin-top: 4px;
    }

    .list {
      margin: 6px 0 0;
      padding-left: 15px;
      font-size: 10px;
      color: #9ca3af;
      line-height: 1.7;
    }

    .footer-note {
      margin-top: 18px;
      font-size: 9px;
      color: #6b7280;
      text-align: right;
    }

    @media (max-width: 900px) {
      body {
        padding: 18px 14px 26px;
      }
      .grid-main,
      .grid-lower {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
<div class="page">
  <!-- Header -->
  <header class="header">
    <div class="brand">
      <div class="brand-logo"></div>
      <div>
        <div class="brand-title">UK Energy Data</div>
        <div class="pill">
          Auto-updated insights
        </div>
      </div>
    </div>
    <nav class="nav">
      <a href="/" class="active">Dashboard</a>
      <a href="/reports/">Daily Reports</a>
      <a href="#sources">Data Sources</a>
      <span class="live-pill">
        <span class="live-dot"></span>
        Live data pipeline
      </span>
    </nav>
  </header>

  <!-- Top grid: left dashboard, right Agile slots -->
  <section class="grid-main">
    <!-- Left: main dashboard -->
    <div class="card">
      <div class="section-label">UK Energy Dashboard</div>
      <h1>Daily snapshot of UK electricity &amp; gas prices</h1>
      <p class="lead">
        Simple, machine-generated summaries based on official Ofgem publications
        and public tariff data. Designed to give households, analysts and
        journalists a clear, low-noise view of where prices sit today.
      </p>

      <div class="metric-row">
        <div class="metric">
          <div class="metric-label">Price cap – Elec (avg)</div>
          <div class="metric-value"><span id="cap-elec">--</span> p/kWh</div>
          <div class="metric-sub">
            Typical direct debit customers, GB avg
          </div>
        </div>
        <div class="metric">
          <div class="metric-label">Price cap – Gas (avg)</div>
          <div class="metric-value"><span id="cap-gas">--</span> p/kWh</div>
          <div class="metric-sub">
            Typical direct debit customers, GB avg
          </div>
        </div>
        <div class="metric">
          <div class="metric-label">Agile Elec – Today (avg)</div>
          <div class="metric-value"><span id="agile-avg">--</span> p/kWh</div>
          <div class="metric-sub">
            From Octopus Agile half-hourly rates (if available)
          </div>
        </div>
      </div>

      <div class="latest-report">
        Ofgem cap period:
        <span id="cap-period">updating…</span><br />
        Latest daily report:
        <a id="latest-report-link" href="/reports/">view snapshot</a>
        <span id="latest-report-date"></span>
      </div>
    </div>

    <!-- Right: Agile slots -->
    <div class="card-soft">
      <div class="section-label">Agile monitor</div>
      <h2 style="font-size:15px;margin:0 0 2px;color:#e5e7eb;">
        Cheapest Agile slots (today)
      </h2>
      <p class="muted" style="margin:0 0 6px;">
        Based on Octopus Agile half-hourly unit rates. Values include VAT.
      </p>
      <ul class="slots-list" id="agile-slots">
        <li><span class="slots-label">Loading live slots…</span></li>
      </ul>
    </div>
  </section>

  <!-- Lower grid: explanation + roadmap -->
  <section class="grid-lower">
    <div class="card-soft">
      <div class="section-label">Automated content</div>
      <h2 style="font-size:14px;margin:0 0 4px;color:#e5e7eb;">
        What this site publishes
      </h2>
      <ul class="list">
        <li>
          Daily summary of the Ofgem default tariff cap (current period, GB averages).
        </li>
        <li>
          Octopus Agile price statistics – daily average and cheapest slots where data is available.
        </li>
        <li>
          Short, machine-generated commentary designed for analysts &amp; journalists.
        </li>
        <li>
          Exportable tables via static HTML &amp; CSV endpoints (work in progress).
        </li>
      </ul>
    </div>

    <div class="card-soft" id="sources">
      <div class="section-label">Transparent &amp; public sources</div>
      <h2 style="font-size:14px;margin:0 0 4px;color:#e5e7eb;">
        How the numbers are calculated
      </h2>
      <ul class="list">
        <li>
          Default tariff cap data from Ofgem official publications (manually verified each cap period).
        </li>
        <li>
          Agile prices from the public Octopus Energy API where available.
        </li>
        <li>
          All calculations are reproducible and run daily via GitHub Actions.
        </li>
        <li>
          If a live source fails, figures are shown as <strong>N/A</strong> rather than guessed.
        </li>
      </ul>
    </div>
  </section>

  <div class="card-soft" style="margin-top:18px;">
    <div class="section-label">About</div>
    <h2 style="font-size:14px;margin:0 0 4px;color:#e5e7eb;">
      What is ukenergydata.co.uk?
    </h2>
    <p class="lead" style="margin-bottom:4px;">
      An independent, automated microsite turning raw UK energy data into
      clear, low-maintenance daily signals. No paywall, no clickbait –
      just concise numbers you can verify.
    </p>
    <p class="lead" style="font-size:10px;max-width:none;">
      This page is experimental and will keep evolving. Use at your own risk.
      Always confirm key decisions against official Ofgem / supplier documents.
    </p>
  </div>

  <div class="footer-note">
    &copy; <span id="year"></span> ukenergydata.co.uk &middot; Generated automatically from
    public data sources.
  </div>
</div>

<!-- Data wiring -->
<script>
  document.getElementById('year').textContent = new Date().getFullYear();

  async function loadDashboard() {
    try {
      const res = await fetch('/data/latest.json', { cache: 'no-cache' });
      if (!res.ok) throw new Error('HTTP ' + res.status);
      const data = await res.json();

      const ofgem = data.ofgem || {};
      const agile = data.agile || {};
      const date = data.date;
      const gen = data.generated_at_utc;

      // Ofgem cap
      if (ofgem.electricity_unit_avg != null) {
        const e = Number(ofgem.electricity_unit_avg);
        document.getElementById('cap-elec').textContent =
          isFinite(e) ? e.toFixed(2) : ofgem.electricity_unit_avg;
      } else {
        document.getElementById('cap-elec').textContent = 'N/A';
      }

      if (ofgem.gas_unit_avg != null) {
        const g = Number(ofgem.gas_unit_avg);
        document.getElementById('cap-gas').textContent =
          isFinite(g) ? g.toFixed(2) : ofgem.gas_unit_avg;
      } else {
        document.getElementById('cap-gas').textContent = 'N/A';
      }

      document.getElementById('cap-period').textContent =
        ofgem.period || 'Ofgem cap period not set';

      // Latest report link
      const reportLink = document.getElementById('latest-report-link');
      const reportDate = document.getElementById('latest-report-date');
      if (date) {
        reportLink.href = `/reports/${date}.html`;
        reportDate.textContent = `(${date})`;
      } else {
        reportDate.textContent = '';
      }

      if (gen) {
        reportDate.textContent += ` · generated ${gen}`;
      }

      // Agile
      const avgEl = document.getElementById('agile-avg');
      const slotsUl = document.getElementById('agile-slots');

      if (agile.has_data) {
        const avg = Number(agile.avg);
        avgEl.textContent = isFinite(avg) ? avg.toFixed(2) : avg;

        slotsUl.innerHTML = '';
        (agile.cheapest_slots || []).slice(0, 5).forEach((s) => {
          // s 格式："{from} — {to} · {price} p/kWh"
          const li = document.createElement('li');

          const parts = String(s).split('·');
          const timePart = parts[0]?.trim() || s;
          const pricePart = parts[1]?.trim() || '';

          const left = document.createElement('span');
          left.className = 'slots-label';
          left.textContent = timePart;

          const right = document.createElement('span');
          right.className = 'slots-price';
          right.textContent = pricePart;

          li.appendChild(left);
          if (pricePart) li.appendChild(right);
          slotsUl.appendChild(li);
        });

        if (!slotsUl.children.length) {
          slotsUl.innerHTML =
            '<li><span class="slots-label">Agile data available, but no slots parsed.</span></li>';
        }
      } else {
        avgEl.textContent = 'N/A';
        slotsUl.innerHTML =
          '<li><span class="slots-label">No Octopus Agile data available for today.</span></li>';
      }
    } catch (err) {
      console.error('Failed to load latest.json', err);
      document.getElementById('cap-elec').textContent = 'N/A';
      document.getElementById('cap-gas').textContent = 'N/A';
      document.getElementById('cap-period').textContent =
        'Live data temporarily unavailable';
      document.getElementById('agile-avg').textContent = 'N/A';
      document.getElementById('agile-slots').innerHTML =
        '<li><span class="slots-label">Failed to load live data.</span></li>';
    }
  }

  loadDashboard();
</script>
</body>
</html>
