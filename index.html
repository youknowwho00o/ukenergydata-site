<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>UK Energy Data — Live Ofgem & Agile Insights</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg: #031026;
      --card: #071a3a;
      --text: #e6f0ff;
      --accent: #3ecbff;
      --subtle: #9bb4d0;
    }
    body {
      font-family: "Inter", system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      line-height: 1.6;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #051732;
      padding: 12px 28px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }
    header h1 {
      font-size: 22px;
      font-weight: 700;
    }
    nav a {
      color: var(--text);
      margin-left: 18px;
      text-decoration: none;
      opacity: 0.8;
    }
    nav a:hover { opacity: 1; color: var(--accent); }

    main {
      max-width: 1000px;
      margin: 32px auto;
      padding: 0 20px;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }
    .card {
      background: var(--card);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 0 20px rgba(0, 100, 255, 0.05);
    }
    h2 {
      font-size: 20px;
      margin-top: 0;
      margin-bottom: 10px;
      color: var(--accent);
    }
    .big {
      font-size: 32px;
      font-weight: 700;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
    }
    input {
      width: 100%;
      padding: 8px;
      border-radius: 8px;
      border: none;
      background: #0b254f;
      color: #fff;
      margin-bottom: 8px;
    }
    footer {
      text-align: center;
      font-size: 13px;
      color: #9bb4d0;
      margin: 40px 0;
    }
    a { color: var(--accent); }
    canvas { margin-top: 16px; }
  </style>
</head>

<body>
  <header>
    <h1>⚡ UK Energy Data</h1>
    <nav>
      <a href="#">Dashboard</a>
      <a href="reports/index.html">Daily Reports</a>
      <a href="#sources">Data Sources</a>
    </nav>
  </header>

  <main>
    <section class="card">
      <h2>Daily snapshot of UK electricity & gas prices</h2>
      <div id="snapshot">Loading...</div>
    </section>

    <section class="card">
      <h2>Quick bill estimator (using current cap)</h2>
      <label>Annual electricity usage (kWh)</label>
      <input id="elecInput" type="number" value="2700">
      <label>Annual gas usage (kWh)</label>
      <input id="gasInput" type="number" value="11500">
      <p id="billOutput" style="margin-top:8px;">Loading...</p>
    </section>

    <section class="card">
      <h2>GB Average Ofgem Price Cap (last 12 months)</h2>
      <canvas id="capChart" height="120"></canvas>
      <p id="chartStatus" style="font-size:13px;opacity:0.6;">Loading...</p>
    </section>

    <section class="card" id="sources">
      <h2>Data sources & transparency</h2>
      <ul>
        <li>Ofgem default tariff cap: official “<a href="https://www.ofgem.gov.uk/information-consumers/energy-advice-households/energy-price-cap-explained" target="_blank">Energy price cap explained</a>”.</li>
        <li>Agile prices: public <a href="https://api.octopus.energy" target="_blank">Octopus Energy API</a>.</li>
        <li>Machine-readable data: <a href="data/latest.json">data/latest.json</a> and <a href="data/ofgem_history.json">data/ofgem_history.json</a>.</li>
      </ul>
    </section>
  </main>

  <footer>
    © ukenergydata.co.uk — Automatically generated from public data sources.
  </footer>

<script>
// --- Load latest snapshot ---
fetch('data/latest.json')
  .then(r => r.json())
  .then(js => {
    const s = js.ofgem;
    const bill = js.typical_bill;
    document.getElementById('snapshot').innerHTML = `
      <div class="grid">
        <div><div class="big">${s.electricity_unit_avg} p/kWh</div><div>Electricity (avg)</div></div>
        <div><div class="big">${s.gas_unit_avg} p/kWh</div><div>Gas (avg)</div></div>
      </div>
      <p>Ofgem cap period: ${s.period}<br>
      Typical dual-fuel bill: £${bill.dual_annual_gbp.toFixed(0)}/year (~£${bill.dual_monthly_gbp.toFixed(0)}/month).</p>
      <p style="opacity:0.7;font-size:13px;">Last updated ${js.generated_at_utc}</p>
    `;
    updateBill();
  });

// --- Bill Estimator ---
function updateBill() {
  fetch('data/latest.json')
    .then(r => r.json())
    .then(js => {
      const e = parseFloat(document.getElementById('elecInput').value);
      const g = parseFloat(document.getElementById('gasInput').value);
      const eu = js.ofgem.electricity_unit_avg / 100;
      const gu = js.ofgem.gas_unit_avg / 100;
      const es = js.ofgem.elec_standing_avg * 365;
      const gs = js.ofgem.gas_standing_avg * 365;
      const elec = e * eu + es;
      const gas = g * gu + gs;
      const total = elec + gas;
      document.getElementById('billOutput').innerHTML =
        `Estimated annual cost: <b>£${total.toFixed(0)}</b> (~£${(total/12).toFixed(0)}/month)
        · Elec £${elec.toFixed(0)} · Gas £${gas.toFixed(0)}<br>
        <span style="font-size:12px;opacity:0.6;">Includes standing charges, GB-average, Direct Debit.</span>`;
    });
}
document.getElementById('elecInput').oninput = updateBill;
document.getElementById('gasInput').oninput = updateBill;

// --- Ofgem History Chart ---
fetch('data/ofgem_history.json')
  .then(r => r.json())
  .then(data => {
    document.getElementById('chartStatus').style.display = 'none';
    const ctx = document.getElementById('capChart').getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: data.map(x => x.label),
        datasets: [
          {
            label: 'Electricity (p/kWh)',
            data: data.map(x => x.electricity_unit_avg),
            borderColor: '#3ecbff',
            backgroundColor: 'rgba(62,203,255,0.1)',
            tension: 0.4,
            fill: true,
            pointRadius: 4,
            pointHoverRadius: 6
          },
          {
            label: 'Gas (p/kWh)',
            data: data.map(x => x.gas_unit_avg),
            borderColor: '#f3b33d',
            backgroundColor: 'rgba(243,179,61,0.1)',
            tension: 0.4,
            fill: true,
            pointRadius: 4,
            pointHoverRadius: 6
          }
        ]
      },
      options: {
        scales: {
          x: {
            ticks: { color: '#c0d2e8' },
            grid: { color: 'rgba(255,255,255,0.05)' }
          },
          y: {
            ticks: { color: '#c0d2e8' },
            grid: { color: 'rgba(255,255,255,0.05)' },
            title: { display: true, text: 'p/kWh (GB avg)', color: '#9bb4d0' }
          }
        },
        plugins: {
          legend: { labels: { color: '#fff' } },
          tooltip: { mode: 'index', intersect: false }
        }
      }
    });
  })
  .catch(err => {
    document.getElementById('chartStatus').innerText = 'Failed to load data.';
    console.error('Chart load error:', err);
  });
</script>

</body>
</html>
