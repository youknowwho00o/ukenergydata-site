<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>UK Energy Data – Daily snapshot of UK electricity &amp; gas prices</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description"
        content="Automated daily snapshot of UK electricity and gas prices, including Ofgem price cap and Octopus Agile data." />
  <style>
    :root {
      --bg: #020817;
      --bg-soft: #050b1c;
      --bg-card: #070f23;
      --border-subtle: rgba(148, 163, 253, 0.12);
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.14);
      --accent-alt: #22c55e;
      --text-main: #e5e7eb;
      --text-subtle: #9ca3af;
      --radius-xl: 22px;
      --radius-pill: 999px;
      --shadow-soft: 0 18px 60px rgba(15, 23, 42, 0.9);
      --font-sans: system-ui, -apple-system, BlinkMacSystemFont, -system-ui, sans-serif;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 30px 22px 40px;
      font-family: var(--font-sans);
      background: radial-gradient(circle at top, #020817 0, #000 55%);
      color: var(--text-main);
    }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }

    .page { max-width: 1320px; margin: 0 auto; }

    header {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 26px;
    }
    .brand-line {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .brand-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 12px var(--accent);
    }
    .brand-title {
      font-size: 22px;
      font-weight: 600;
    }
    .brand-sub {
      font-size: 13px;
      padding: 2px 9px;
      border-radius: var(--radius-pill);
      background: var(--accent-soft);
      color: var(--accent);
      border: 1px solid rgba(56, 189, 248, 0.4);
    }
    nav {
      display: flex;
      gap: 16px;
      align-items: center;
      flex-wrap: wrap;
      font-size: 13px;
      margin-top: 4px;
    }
    nav a { color: var(--text-subtle); }
    nav a.active { color: var(--accent); font-weight: 500; }
    .live-pill {
      margin-left: auto;
      padding: 4px 10px;
      border-radius: var(--radius-pill);
      font-size: 11px;
      background: rgba(22, 163, 74, 0.12);
      color: var(--accent-alt);
      border: 1px solid rgba(34, 197, 94, 0.4);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .live-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: var(--accent-alt);
      box-shadow: 0 0 10px var(--accent-alt);
    }

    .status-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 6px;
      font-size: 10px;
    }
    .status-pill {
      padding: 4px 9px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(56, 189, 248, 0.28);
      background: rgba(15, 23, 42, 0.9);
      color: var(--accent);
    }
    .status-pill.warn {
      border-color: rgba(234, 179, 8, 0.5);
      color: #fde68a;
      background: rgba(120, 53, 15, 0.32);
    }
    .status-pill.error {
      border-color: rgba(248, 113, 113, 0.7);
      color: #fecaca;
      background: rgba(127, 29, 29, 0.4);
    }

    .grid {
      display: grid;
      grid-template-columns: minmax(0, 7fr) minmax(280px, 4fr);
      gap: 18px;
      align-items: flex-start;
    }

    .card {
      background: var(--bg-card);
      border-radius: var(--radius-xl);
      padding: 18px 18px 16px;
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
    }

    .headline {
      font-size: 26px;
      font-weight: 600;
      margin: 0 0 6px;
    }
    .lede {
      font-size: 13px;
      color: var(--text-subtle);
      margin: 0 0 14px;
      max-width: 760px;
    }

    .top-metrics {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
      margin-bottom: 8px;
    }
    .metric {
      padding: 12px 12px 10px;
      border-radius: 18px;
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.12), var(--bg-soft));
      border: 1px solid rgba(148, 163, 253, 0.18);
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .metric-label { font-size: 11px; color: var(--text-subtle); }
    .metric-value { font-size: 20px; font-weight: 600; }
    .metric-caption { font-size: 10px; color: var(--text-subtle); }

    .meta-line {
      font-size: 10px;
      color: var(--text-subtle);
      margin-top: 3px;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      margin: 0 0 6px;
    }
    .section-text {
      font-size: 11px;
      color: var(--text-subtle);
      margin: 0 0 4px;
    }
    .list {
      padding-left: 16px;
      margin: 4px 0 0;
      font-size: 11px;
      color: var(--text-subtle);
    }
    .list li { margin-bottom: 2px; }

    .agile-list {
      font-size: 10px;
      color: var(--text-subtle);
      margin-top: 6px;
      padding-left: 14px;
    }

    footer {
      margin-top: 24px;
      font-size: 9px;
      color: var(--text-subtle);
      text-align: left;
    }

    @media (max-width: 840px) {
      body { padding: 16px 14px 26px; }
      .grid { grid-template-columns: 1fr; }
      .top-metrics { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
<div class="page">
  <header>
    <div class="brand-line">
      <div class="brand-dot"></div>
      <div class="brand-title">UK Energy Data</div>
      <div class="brand-sub">Auto-updated insights</div>
      <div class="live-pill">
        <div class="live-dot"></div>
        Live data pipeline
      </div>
    </div>
    <nav>
      <a href="index.html" class="active">Dashboard</a>
      <a href="reports/index.html">Daily Reports</a>
      <!-- 现在跳转到本页下方的 Data Sources 区块 -->
      <a href="#data-sources">Data Sources</a>
    </nav>
    <div class="status-bar">
      <span id="status-ofgem" class="status-pill">Ofgem cap: loading…</span>
      <span id="status-agile" class="status-pill">Octopus Agile: loading…</span>
    </div>
  </header>

  <div class="grid">
    <!-- Left: main dashboard -->
    <section class="card">
      <div class="headline">Daily snapshot of UK electricity &amp; gas prices</div>
      <p class="lede">
        Concise, automatically generated summaries using official Ofgem publications
        and public tariff data. No spin — just current headline numbers for analysts,
        journalists and households.
      </p>

      <div class="top-metrics">
        <div class="metric">
          <div class="metric-label">Price cap – Elec (avg)</div>
          <div id="metric-elec" class="metric-value">-- p/kWh</div>
          <div class="metric-caption">Typical direct debit customers, GB average.</div>
        </div>
        <div class="metric">
          <div class="metric-label">Price cap – Gas (avg)</div>
          <div id="metric-gas" class="metric-value">-- p/kWh</div>
          <div class="metric-caption">Typical direct debit customers, GB average.</div>
        </div>
        <div class="metric">
          <div class="metric-label">Agile Elec – Today (avg)</div>
          <div id="metric-agile" class="metric-value">N/A p/kWh</div>
          <div class="metric-caption">From Octopus Agile half-hourly rates (if available).</div>
        </div>
      </div>

      <div class="meta-line" id="ofgem-period">
        Ofgem cap period: updating…
      </div>
      <div class="meta-line" id="typical-bill-line">
        Typical dual-fuel bill under current cap: calculating…
      </div>
      <div class="meta-line" id="latest-report">
        Latest daily report: loading…
      </div>
    </section>

    <!-- Right: Agile + methodology -->
    <aside class="card">
      <div class="section-title">Cheapest Agile slots (today)</div>
      <div class="section-text">
        Based on Octopus Agile half-hourly unit rates (incl. VAT), when data is available.
      </div>
      <div id="agile-slots" class="section-text">Loading live slots…</div>
      <ul id="agile-slots-list" class="agile-list"></ul>

      <hr style="border: none; border-top: 1px solid rgba(148,163,253,0.16); margin: 10px 0;" />

      <div class="section-title">How the numbers are calculated</div>
      <ul class="list">
        <li>Default tariff cap data scraped from Ofgem’s official “Energy price cap explained” page.</li>
        <li>Agile prices from the public Octopus Energy API, when available.</li>
        <li>All processing runs automatically via GitHub Actions; everything is reproducible.</li>
        <li>If a live source fails, numbers are clearly marked as N/A or fallback.</li>
      </ul>
    </aside>
  </div>

  <!-- Lower content blocks -->
  <div class="grid" style="margin-top: 16px;">
    <section class="card">
      <div class="section-title">What this site publishes</div>
      <ul class="list">
        <li>Daily summary of the Ofgem default tariff cap (current period, GB averages).</li>
        <li>Octopus Agile average prices and cheapest half-hour slots (when data exists).</li>
        <li>Human-readable daily snapshot pages for quick referencing.</li>
        <li>Machine-readable JSON via <code>data/latest.json</code> for reuse.</li>
      </ul>
    </section>

    <section class="card">
      <div class="section-title">What is ukenergydata.co.uk?</div>
      <p class="section-text">
        An independent, automated microsite turning raw UK energy data into clear, low-noise
        daily signals. No paywall, no clickbait — just verifiable numbers from public sources.
      </p>
      <p class="section-text">
        This project is experimental. Always confirm critical decisions against official Ofgem
        publications or supplier tariffs.
      </p>
    </section>
  </div>

  <!-- Data Sources block (anchor target) -->
  <div class="grid" style="margin-top: 16px;" id="data-sources">
    <section class="card">
      <div class="section-title">Data sources &amp; endpoints</div>
      <ul class="list">
        <li>
          Ofgem default tariff cap:
          scraped from
          <a href="https://www.ofgem.gov.uk/information-consumers/energy-advice-households/energy-price-cap-explained"
             target="_blank" rel="noopener">“Energy price cap explained”</a>.
        </li>
        <li>
          Typical bill calculation:
          Ofgem TDCV (2,700 kWh electricity, 11,500 kWh gas) applied to GB-average cap rates.
        </li>
        <li>
          Octopus Agile electricity:
          public Octopus Energy API (half-hourly unit rates), when available.
        </li>
        <li>
          Latest machine-readable snapshot:
          <code><a href="data/latest.json" target="_blank" rel="noopener">data/latest.json</a></code>.
        </li>
        <li>
          Full site source code:
          <a href="https://github.com/youknowwho00o/ukenergydata-site"
             target="_blank" rel="noopener">GitHub repository</a>.
        </li>
      </ul>
    </section>

    <section class="card">
      <div class="section-title">Transparency</div>
      <p class="section-text">
        All numbers are generated automatically from reproducible scripts. If a live source fails,
        the UI will label values as cached or fallback. Always cross-check against official Ofgem
        publications and supplier tariffs before making decisions.
      </p>
    </section>
  </div>

  <footer>
    &copy; ukenergydata.co.uk · Generated automatically from public data sources.
  </footer>
</div>

<script>
async function loadDashboard() {
  try {
    const res = await fetch('data/latest.json', { cache: 'no-store' });
    const data = await res.json();

    // --- Ofgem ---
    const ofgem = data.ofgem || {};
    const statusOfgem = document.getElementById('status-ofgem');
    const elecEl = document.getElementById('metric-elec');
    const gasEl = document.getElementById('metric-gas');
    const periodEl = document.getElementById('ofgem-period');
    const typicalBillEl = document.getElementById('typical-bill-line');

    if (ofgem.electricity_unit_avg && ofgem.gas_unit_avg) {
      elecEl.textContent = ofgem.electricity_unit_avg.toFixed(2) + ' p/kWh';
      gasEl.textContent = ofgem.gas_unit_avg.toFixed(2) + ' p/kWh';
      periodEl.textContent = 'Ofgem cap period: ' + ofgem.period;

      if (statusOfgem) {
        if (ofgem.source === 'live') {
          statusOfgem.textContent = 'Ofgem cap: live from official source';
          statusOfgem.classList.remove('warn', 'error');
        } else if (ofgem.source === 'live-cache') {
          statusOfgem.textContent = 'Ofgem cap: using last successful live values (cache)';
          statusOfgem.classList.add('warn');
          statusOfgem.classList.remove('error');
        } else {
          statusOfgem.textContent = 'Ofgem cap: fallback values (check latest Ofgem docs)';
          statusOfgem.classList.add('warn');
          statusOfgem.classList.remove('error');
        }
      }
    } else {
      elecEl.textContent = '-- p/kWh';
      gasEl.textContent = '-- p/kWh';
      periodEl.textContent = 'Ofgem cap period: N/A';
      if (statusOfgem) {
        statusOfgem.textContent = 'Ofgem cap: unavailable';
        statusOfgem.classList.add('error');
      }
    }

    // --- Typical bill line ---
    const tb = data.typical_bill || null;
    if (tb && tb.dual_annual_gbp) {
      const yr = tb.dual_annual_gbp.toFixed(0);
      const mo = tb.dual_monthly_gbp.toFixed(0);
      typicalBillEl.textContent =
        `Typical dual-fuel bill under current cap (Ofgem TDCV): £${yr}/year (~£${mo}/month).`;
    } else {
      typicalBillEl.textContent = 'Typical dual-fuel bill under cap: not available.';
    }

    // --- Agile summary ---
    const agile = data.agile || {};
    const statusAgile = document.getElementById('status-agile');
    const agileAvgEl = document.getElementById('metric-agile');
    const agileSlotsText = document.getElementById('agile-slots');
    const agileSlotsList = document.getElementById('agile-slots-list');

    if (agile.has_data && agile.avg != null) {
      agileAvgEl.textContent = agile.avg.toFixed(2) + ' p/kWh';
      if (statusAgile) {
        statusAgile.textContent = 'Octopus Agile: today data loaded';
        statusAgile.classList.remove('warn', 'error');
      }

      if (Array.isArray(agile.cheapest_slots) && agile.cheapest_slots.length > 0) {
        agileSlotsText.textContent = 'Cheapest half-hour slots (local time):';
        agileSlotsList.innerHTML = '';
        agile.cheapest_slots.slice(0, 6).forEach(slot => {
          const li = document.createElement('li');
          li.textContent = slot;
          agileSlotsList.appendChild(li);
        });
      } else {
        agileSlotsText.textContent = 'Agile data loaded, but no cheapest slots summary available.';
      }
    } else {
      agileAvgEl.textContent = 'N/A p/kWh';
      agileSlotsText.textContent = 'No Octopus Agile half-hourly data available for today.';
      agileSlotsList.innerHTML = '';
      if (statusAgile) {
        statusAgile.textContent = 'Octopus Agile: no data for today';
        statusAgile.classList.add('warn');
        statusAgile.classList.remove('error');
      }
    }

    // --- Latest report link ---
    const latestReportEl = document.getElementById('latest-report');
    if (data.date && latestReportEl) {
      latestReportEl.innerHTML =
        `Latest daily report: <a href="reports/${data.date}.html">view snapshot (${data.date})</a>` +
        (data.generated_at_utc ? ` · generated ${data.generated_at_utc}` : '');
    }

  } catch (err) {
    console.error('Failed to load latest.json', err);
    const so = document.getElementById('status-ofgem');
    const sa = document.getElementById('status-agile');
    if (so) {
      so.textContent = 'Failed to load latest data';
      so.classList.add('error');
    }
    if (sa) {
      sa.textContent = '';
    }
    const tb = document.getElementById('typical-bill-line');
    if (tb) tb.textContent = 'Typical dual-fuel bill under cap: unavailable.';
  }
}

loadDashboard();
</script>
</body>
</html>
